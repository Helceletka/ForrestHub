{% extends "templates/base.html" %}
{% set game_name = "Náhodné číslo - Zobrazení času" %}
{% block content %}
    <div class="container mt-4">
        <h1 class="mb-4">Vygeneruj náhodné číslo</h1>
        <div class="d-grid gap-2 mb-4">
            <button id="generateNumberButton" class="btn btn-primary btn-lg">Generovat číslo</button>
        </div>
        <p class="fw-bold">Vygenerované číslo:</p>
        <div id="generatedNumber" class="alert alert-info" role="alert">Žádné číslo nebylo vygenerováno</div>
        <p class="fw-bold">Poslední změna čísla:</p>
        <div id="lastChangeTime" class="alert alert-secondary" role="alert">Žádný čas změny</div>
    </div>

    <script>
        forrestHubLib = window.forrestHubLib || new ForrestHubLib();
        let generatedNumber = null;
        let lastChangeTime = null;

        document.addEventListener('DOMContentLoaded', function () {
            const generateNumberButton = document.getElementById('generateNumberButton');
            const generatedNumberDisplay = document.getElementById('generatedNumber');
            const lastChangeTimeDisplay = document.getElementById('lastChangeTime');

            // Načti předchozí vygenerované číslo a čas
            forrestHubLib.getKey('generatedNumber').then((value) => {
                if (value) {
                    generatedNumber = value.number;
                    lastChangeTime = value.time;
                    updateDisplay(generatedNumber, lastChangeTime);
                }
            }).catch((err) => {
                console.error('Chyba při načítání čísla:', err);
            });

            // Generování nového čísla po kliknutí
            generateNumberButton.addEventListener('click', () => {
                generatedNumber = Math.floor(Math.random() * 1000);
                lastChangeTime = new Date().toLocaleTimeString();

                forrestHubLib.setKeyBroadcast('generatedNumber', { number: generatedNumber, time: lastChangeTime }).then(() => {
                    updateDisplay(generatedNumber, lastChangeTime);
                }).catch((err) => {
                    console.error('Chyba při odesílání čísla:', err);
                });
            });

            // Poslouchej změny od ostatních zařízení
            forrestHubLib.addEventListenerKey('generatedNumber', (data) => {
                generatedNumber = data.number;
                lastChangeTime = data.time;
                updateDisplay(generatedNumber, lastChangeTime);
            });
        });

        // Aktualizace zobrazení čísla a času změny
        function updateDisplay(number, time) {
            const generatedNumberDisplay = document.getElementById('generatedNumber');
            const lastChangeTimeDisplay = document.getElementById('lastChangeTime');

            generatedNumberDisplay.textContent = `Vygenerované číslo je: ${number}`;
            lastChangeTimeDisplay.textContent = `Poslední změna v: ${time}`;
        }
    </script>
{% endblock %}
