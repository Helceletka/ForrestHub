{% extends "templates/base.html" %}
{% set game_name = "Obsazování území - Tabule" %}
{% block content %}
    <div class="container">
        <h1 class="text-center mb-4">Stav obsazení území</h1>
        <canvas id="territoryChart"></canvas>
    </div>

    <!-- Načtení knihovny Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        forrestHubLib = window.forrestHubLib || new ForrestHubLib();
        let teamTimes = { A: 0, B: 0, C: 0, D: 0 };

        const ctx = document.getElementById('territoryChart').getContext('2d');
        const territoryChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Tým A', 'Tým B', 'Tým C', 'Tým D'],
                datasets: [{
                    data: [0, 0, 0, 0],
                    backgroundColor: ['blue', 'green', 'yellow', 'red'],
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (context) => {
                                const label = context.label || '';
                                const value = context.raw || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(2);
                                return `${label}: ${value}s (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        function updateChart() {
            const totalTime = Object.values(teamTimes).reduce((a, b) => a + b, 0) || 1;
            const normalizedTimes = Object.values(teamTimes).map(time => (time / totalTime) * 100);

            territoryChart.data.datasets[0].data = normalizedTimes;
            territoryChart.update();
        }

        forrestHubLib.addEventListenerKey('team_times', (times) => {
            teamTimes = times;
            updateChart();
        });

        setInterval(updateChart, 1000); // Pravidelná aktualizace grafu
    </script>
{% endblock %}
