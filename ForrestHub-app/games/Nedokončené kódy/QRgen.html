<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investiční aplikace</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .container {
            display: flex;
            flex-grow: 1;
        }
        .investment, .evaluation {
            width: 50%;
            padding: 20px;
            box-sizing: border-box;
        }
        .investment {
            background-color: #f0f0f0;
        }
        .evaluation {
            background-color: #e0e0e0;
        }
        h2 {
            margin: 0;
        }
        .underline-first-letter::first-letter {
            text-decoration: underline;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        .risk-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .risk-button {
            padding: 10px;
            cursor: pointer;
            background-color: #d3d3d3;
            border: none;
            font-weight: bold;
            flex-grow: 1;
        }
        .risk-button.selected {
            background-color: #007bff;
            color: white;
        }
        .risk-output, .fee-output, .yes-button, .print-button {
            margin-top: 10px;
            font-weight: bold;
        }
        .yes-button, .print-button {
            cursor: pointer;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            display: inline-block;
            margin-right: 10px;
        }
        .large-code, .large-reward {
            font-size: 2em;
            text-align: center;
            margin-top: 20px;
            color: #007bff;
        }
        .log {
            margin-top: 20px;
            background-color: #f4f4f4;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
        .code-input {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .code-input input {
            width: 40px;
            text-align: center;
            font-size: 1.2em;
        }
        .preview-button, .complete-button {
            cursor: pointer;
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            font-weight: bold;
            margin-right: 10px;
        }
        #outcome-result {
            margin-top: 20px;
            font-size: 1.2em;
        }
        .strike {
            text-decoration: line-through;
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="investment">
            <h2 class="underline-first-letter">Investment</h2>
            <div class="form-group">
                <label for="amount">Investovaná částka:</label>
                <input type="text" id="amount" placeholder="Zadejte částku" oninput="formatAsCurrency()" onkeypress="return isNumberKey(event)">
            </div>
            <div class="form-group">
                <label for="risk">Míra rizika:</label>
                <div class="risk-buttons">
                    <button id="riskA" class="risk-button" onclick="selectRisk('A')">A - Bezpečný</button>
                    <button id="riskS" class="risk-button" onclick="selectRisk('S')">S - Střední</button>
                    <button id="riskD" class="risk-button" onclick="selectRisk('D')">D - Nebezpečný</button>
                </div>
            </div>
            <div id="fee-output" class="fee-output"></div>
            <div id="yes-button" class="yes-button underline-first-letter" onclick="confirmInvestment()">Yes</div>
            <div id="print-button" class="print-button" onclick="printInvestment()">Tisk</div>
        </div>
        <div class="evaluation">
            <h2 class="underline-first-letter">Outcome</h2>
            <div id="evaluation" class="evaluation-content" tabindex="0">
                <div class="code-input">
                    <input type="text" maxlength="1" id="code1" oninput="moveToNext(this, 'code2')">
                    <input type="text" maxlength="1" id="code2" oninput="moveToNext(this, 'code3')">
                    <input type="text" maxlength="1" id="code3" oninput="moveToNext(this, 'code4')">
                    <input type="text" maxlength="1" id="code4" oninput="moveToNext(this, 'code5')">
                    <input type="text" maxlength="1" id="code5" oninput="moveToNext(this)">
                </div>
                <div class="form-group">
                    <button id="preview-button" class="preview-button underline-first-letter" onclick="evaluateInvestment()">Preview</button>
                    <button id="complete-button" class="complete-button underline-first-letter" onclick="completeInvestment()">Complete</button>
                </div>
                <div id="outcome-result"></div>
            </div>
        </div>
    </div>
    <div id="large-code" class="large-code"></div>
    <div id="large-reward" class="large-reward"></div>
    <div id="log" class="log">
        <h3>Investment Log</h3>
        <div id="log-content"></div>
    </div>

    <script>
        let selectedRisk = '';
        let generatedCodes = new Set();  // To store generated codes and ensure uniqueness
        let investments = {}; // To store investment data by code

        const forbiddenChars = ['I', 'O', 'Y', 'C'];

        function isNumberKey(evt) {
            let charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function formatAsCurrency() {
            let input = document.getElementById('amount');
            let value = input.value;

            // Odebereme všechny nečíselné znaky
            value = value.replace(/[^0-9]/g, '');

            // Rozdělíme na celé číslo a desetinnou část (pokud existuje)
            let integerPart = value;

            // Přidáme tisícové oddělovače
            integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, " ");

            // Spojíme zpět dohromady
            input.value = integerPart;

            calculateFee(parseFloat(integerPart.replace(/\s+/g, '')));
        }

        function calculateFee(amount) {
            let feeOutput = document.getElementById('fee-output');
            let fee = 0;

            if (amount <= 100) {
                fee = Math.ceil(0.05 * amount);
            } else if (amount <= 1000) {
                fee = Math.ceil(0.10 * amount);
            } else if (amount <= 10000) {
                fee = Math.ceil(0.15 * amount);
            } else {
                fee = Math.ceil(0.20 * amount);
            }

            feeOutput.textContent = "Investment Fee: " + fee.toLocaleString() + " Ǥ";
        }

        function selectRisk(risk) {
            selectedRisk = risk;
            document.querySelectorAll('.risk-button').forEach(button => {
                button.classList.remove('selected');
            });
            document.getElementById('risk' + risk).classList.add('selected');
        }

        function generateUniqueCode() {
            let letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').filter(char => !forbiddenChars.includes(char));
            let code;

            do {
                code = '';
                for (let i = 0; i < 5; i++) {
                    code += letters[Math.floor(Math.random() * letters.length)];
                }
            } while (generatedCodes.has(code)); // Ensure the code is unique

            generatedCodes.add(code);
            return code;
        }

        function confirmInvestment() {
            let amount = document.getElementById('amount').value.replace(/\s+/g, '');
            if (!amount || !selectedRisk) {
                alert("Prosím zadejte částku a vyberte míru rizika.");
                return;
            }

            if (confirm("Opravdu chcete tuto investici provést?")) {
                let uniqueCode = generateUniqueCode(); // Vygenerování unikátního pětimístného kódu
                let timestamp = new Date();
                let timeOnly = timestamp.toLocaleTimeString();

                // Uložení investice
                investments[uniqueCode] = {
                    amount: parseFloat(amount),
                    risk: selectedRisk,
                    startTime: timestamp,
                    fee: parseFloat(document.getElementById('fee-output').textContent.split(' ')[2])
                };

                // Zobrazení velkého kódu nad logem
                document.getElementById('large-code').textContent = "Investment Code: " + uniqueCode;

                // Zápis do logu
                let logContent = document.getElementById('log-content');
                logContent.innerHTML = `<p id="log-${uniqueCode}">Kód: ${uniqueCode}, Částka: ${amount} Ǥ, Riziko: ${selectedRisk}, Čas: ${timeOnly}</p>` + logContent.innerHTML;
            }
        }

        function printInvestment() {
            let amount = document.getElementById('amount').value.replace(/\s+/g, '');
            if (!amount || !selectedRisk) {
                alert("Prosím zadejte částku a vyberte míru rizika.");
                return;
            }

            let fee = parseFloat(document.getElementById('fee-output').textContent.split(' ')[2]);
            let timestamp = new Date();
            let timeOnly = timestamp.toLocaleTimeString();

            let sharkTime = 4;
            let wolfTime = 8;
            let turtleTime = 12;

            let sharkReward, wolfReward, turtleReward;

            if (selectedRisk === 'A') {
                sharkReward = Math.ceil(1.4 * amount);
                wolfReward = Math.ceil(1.3 * amount);
                turtleReward = Math.ceil(1.25 * amount);
            } else if (selectedRisk === 'S') {
                sharkReward = Math.ceil(1.6 * amount);
                wolfReward = Math.ceil(1.4 * amount);
                turtleReward = Math.ceil(1.1 * amount);
            } else if (selectedRisk === 'D') {
                sharkReward = Math.ceil(2.05 * amount);
                wolfReward = Math.ceil(1.05 * amount);
                turtleReward = Math.ceil(0.55 * amount);
            }

            let printWindow = window.open('', '', 'width=600,height=400');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Gringottova kouzelnická banka</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { font-size: 24px; }
                        h2 { font-size: 18px; margin-top: 20px; }
                        p { font-size: 16px; margin: 5px 0; }
                    </style>
                </head>
                <body>
                    <h1>Gringottova kouzelnická banka</h1>
                    <h2>Rekapitulace investice</h2>
                    <p><strong>Investovaná částka:</strong> ${amount} Ǥ</p>
                    <p><strong>Čas investice:</strong> ${timeOnly}</p>
                    <p><strong>Zaplacené poplatky:</strong> ${fee} Ǥ</p>
                    <p><strong>Míra rizika:</strong> ${selectedRisk}</p>
                    <h2>Limity a možné odměny:</h2>
                    <p><strong>Limitní čas pro Shark:</strong> ${sharkTime} minut</p>
                    <p><strong>Možná odměna (při Shark):</strong> ${sharkReward} Ǥ</p>
                    <p><strong>Limitní čas pro Wolf:</strong> ${wolfTime} minut</p>
                    <p><strong>Možná odměna (při Wolf):</strong> ${wolfReward} Ǥ</p>
                    <p><strong>Limitní čas pro Turtle:</strong> ${turtleTime} minut</p>
                    <p><strong>Možná odměna (při Turtle):</strong> ${turtleReward} Ǥ</p>
                    <p><strong>Limitní čas pro neúspěch:</strong> Nad ${turtleTime} minut</p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function moveToNext(current, nextFieldId) {
            if (current.value.length === 1 && nextFieldId) {
                document.getElementById(nextFieldId).focus();
            }
        }

        function evaluateInvestment() {
            let code = getCodeFromInputs();
            
            if (!investments[code]) {
                alert("Investice s tímto kódem neexistuje.");
                return;
            }

            let investment = investments[code];
            let now = new Date();
            let duration = (now - investment.startTime) / 60000; // in minutes

            let speed = '';
            if (duration <= 4) {
                speed = '🦈 shark';
            } else if (duration <= 8) {
                speed = '🐺 wolf';
            } else if (duration <= 12) {
                speed = '🐢 turtle';
            } else {
                speed = '❌ fail';
            }

            let reward = calculateReward(investment.amount, investment.risk, speed);

            document.getElementById('outcome-result').innerHTML = `
                <p>Investovaná částka: ${investment.amount} Ǥ</p>
                <p>Délka trvání: ${duration.toFixed(2)} minut (${speed})</p>
                <p>Míra rizika: ${investment.risk}</p>
                <p>Očekávaná odměna: ${reward.toLocaleString()} Ǥ</p>
            `;
        }

        function completeInvestment() {
            let code = getCodeFromInputs();
            
            if (!investments[code]) {
                alert("Investice s tímto kódem neexistuje.");
                return;
            }

            let investment = investments[code];
            let now = new Date();
            let duration = (now - investment.startTime) / 60000; // in minutes

            let speed = '';
            if (duration <= 4) {
                speed = '🦈 shark';
            } else if (duration <= 8) {
                speed = '🐺 wolf';
            } else if (duration <= 12) {
                speed = '🐢 turtle';
            } else {
                speed = '❌ fail';
            }

            let reward = calculateReward(investment.amount, investment.risk, speed);

            // Display the reward prominently
            document.getElementById('large-reward').textContent = `Reward: ${reward.toLocaleString()} Ǥ`;

            // Invalidate the code and strike it out in the log
            let logEntry = document.getElementById(`log-${code}`);
            if (logEntry) {
                logEntry.classList.add('strike');
            }

            delete investments[code];
        }

        function calculateReward(amount, risk, speed) {
            let multiplier = 1;
            if (risk === 'A') {
                if (speed === '🦈 shark') multiplier = 1.4;
                else if (speed === '🐺 wolf') multiplier = 1.3;
                else if (speed === '🐢 turtle') multiplier = 1.25;
                else multiplier = 1.0;
            } else if (risk === 'S') {
                if (speed === '🦈 shark') multiplier = 1.6;
                else if (speed === '🐺 wolf') multiplier = 1.4;
                else if (speed === '🐢 turtle') multiplier = 1.1;
                else multiplier = 0.5;
            } else if (risk === 'D') {
                if (speed === '🦈 shark') multiplier = 2.05;
                else if (speed === '🐺 wolf') multiplier = 1.05;
                else if (speed === '🐢 turtle') multiplier = 0.55;
                else multiplier = 0.0;
            }
            return Math.ceil(amount * multiplier);
        }

        function getCodeFromInputs() {
            return document.getElementById('code1').value +
                   document.getElementById('code2').value +
                   document.getElementById('code3').value +
                   document.getElementById('code4').value +
                   document.getElementById('code5').value;
        }

        function clearInputs() {
            document.getElementById('amount').value = '';
            document.getElementById('riskA').classList.remove('selected');
            document.getElementById('riskS').classList.remove('selected');
            document.getElementById('riskD').classList.remove('selected');
            document.getElementById('code1').value = '';
            document.getElementById('code2').value = '';
            document.getElementById('code3').value = '';
            document.getElementById('code4').value = '';
            document.getElementById('code5').value = '';
            document.getElementById('fee-output').textContent = '';
            document.getElementById('outcome-result').innerHTML = '';
            document.getElementById('large-code').textContent = '';
            document.getElementById('large-reward').textContent = '';
        }

        document.addEventListener('keydown', function(event) {
            let key = event.key.toLowerCase();

            if (key === 'i') {
                clearInputs();
                document.getElementById('amount').focus();
            } else if (key === 'o') {
                clearInputs();
                event.preventDefault(); // Prevent 'o' from being entered into the input
                document.getElementById('code1').focus();
            } else if (key === 'y') {
                if (document.getElementById('amount') === document.activeElement || document.getElementById('riskA').classList.contains('selected') || document.getElementById('riskS').classList.contains('selected') || document.getElementById('riskD').classList.contains('selected')) {
                    confirmInvestment();
                }
            } else if (key === 'c') {
                if (document.getElementById('code1') === document.activeElement || document.getElementById('code2').value || document.getElementById('code3').value || document.getElementById('code4').value || document.getElementById('code5').value) {
                    completeInvestment();
                }
            } else if (key === 'a' || key === 's' || key === 'd') {
                selectRisk(key.toUpperCase());
            }
        });
    </script>
</body>
</html>
